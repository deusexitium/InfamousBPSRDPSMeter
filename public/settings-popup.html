<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Infamous BPSR DPS Meter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/color-scheme.css?v=3.1.166">
    <link rel="stylesheet" href="css/style.css?v=3.1.166">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-dark);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
        }
        
        .popup-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .popup-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            -webkit-app-region: drag;
            cursor: move;
            user-select: none;
        }
        
        .popup-title {
            font-size: 13px;
            font-weight: 600;
            color: #000;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .popup-close {
            -webkit-app-region: no-drag;
            background: rgba(0,0,0,0.2);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        
        .popup-close:hover {
            background: rgba(0,0,0,0.3);
        }
        
        .popup-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px 16px;
        }
        
        .settings-container {
            max-width: 100%;
        }
        
        /* Compact styles */
        .settings-tabs {
            gap: 4px;
            margin-bottom: 12px;
        }
        
        .settings-tab {
            font-size: 11px !important;
            padding: 6px 10px !important;
        }
        
        .settings-panel {
            font-size: 12px;
        }
        
        .settings-panel h3 {
            font-size: 13px !important;
            margin-bottom: 8px !important;
        }
        
        .settings-panel h4 {
            font-size: 12px !important;
            margin-bottom: 6px !important;
        }
        
        .settings-panel p {
            font-size: 10px !important;
        }
        
        .settings-grid {
            gap: 6px !important;
        }
        
        .settings-grid label {
            font-size: 11px !important;
            padding: 4px 6px !important;
        }
        
        .settings-inline label {
            font-size: 11px !important;
        }
        
        .settings-inline input[type="number"],
        .settings-inline input[type="text"] {
            font-size: 11px !important;
        }
        
        select {
            font-size: 11px !important;
        }
        
        .btn-primary, .btn-tiny {
            font-size: 11px !important;
            padding: 6px 12px !important;
        }
    </style>
</head>
<body>
    <div class="popup-container">
        <div class="popup-header">
            <div class="popup-title">
                <i class="fa-solid fa-gear"></i>
                Settings
            </div>
            <button class="popup-close" onclick="window.close()">
                <i class="fa-solid fa-times" style="color:#000; font-size:14px;"></i>
            </button>
        </div>
        
        <div class="popup-content">
            <div class="settings-container">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">
                        <i class="fa-solid fa-sliders"></i> General
                    </button>
                    <button class="settings-tab" data-tab="display">
                        <i class="fa-solid fa-eye"></i> Display
                    </button>
                    <button class="settings-tab" data-tab="overlay">
                        <i class="fa-solid fa-layer-group"></i> Overlay
                    </button>
                    <button class="settings-tab" data-tab="about">
                        <i class="fa-solid fa-info-circle"></i> About
                    </button>
                </div>

                <!-- General Tab -->
                <div class="settings-panel active" data-panel="general">
                    <div class="settings-grid">
                        <label><input type="checkbox" id="setting-highlight" checked> Highlight Local Player</label>
                        <label><input type="checkbox" id="setting-remember-names" checked> Remember Names</label>
                        <label><input type="checkbox" id="setting-auto-clear-zone" checked> Auto-Clear on Zone</label>
                        <label><input type="checkbox" id="setting-keep-after-dungeon" checked> Keep After Dungeon</label>
                    </div>
                    <div class="settings-inline">
                        <label>Refresh: <input type="number" id="setting-refresh" min="0.1" max="5" step="0.1" value="0.5" style="width:60px">s</label>
                        <label>Name: <input type="text" id="setting-my-name" placeholder="Your name" style="width:140px"> <button id="btn-save-my-name" class="btn-tiny">Save</button></label>
                    </div>
                    
                    <!-- Auto-Update Setting -->
                    <div style="margin-top:12px; padding:10px; background:rgba(59, 130, 246, 0.08); border-left:3px solid #3b82f6; border-radius:4px;">
                        <h4 style="margin:0 0 6px 0; color:#60a5fa; font-size:12px; font-weight:600;">
                            <i class="fa-solid fa-download"></i> Auto-Update
                        </h4>
                        <label style="display:block; margin-bottom:4px;">
                            <select id="setting-auto-update" style="width:100%; padding:6px; background:var(--bg-card); border:1px solid var(--border); color:var(--text-primary); border-radius:4px; font-size:11px;">
                                <option value="auto">Auto Update (Download & Install Automatically)</option>
                                <option value="notify">Notify Only (Show Update Available)</option>
                                <option value="disable">Disable (No Update Checks)</option>
                            </select>
                        </label>
                        <p style="font-size:10px; color:#9ca3af; margin:4px 0 0 0; font-style:italic;">
                            💡 Recommended: Notify Only - gives you control over updates
                        </p>
                    </div>
                    
                    <!-- Boss Mapping Contribution -->
                    <div style="margin-top:16px; padding:12px; background:rgba(16, 185, 129, 0.1); border-left:3px solid #10b981; border-radius:4px;">
                        <h4 style="margin:0 0 8px 0; color:#10b981; font-size:13px; font-weight:600;">
                            <i class="fa-solid fa-map"></i> Boss Mapping Contributions
                        </h4>
                        <p style="font-size:11px; color:#9ca3af; margin:0 0 10px 0;">
                            Help improve the boss database by exporting unknown IDs
                        </p>
                        <button id="btn-export-unknown-ids" class="btn-primary" style="width:100%; background:#10b981; font-size:11px;">
                            <i class="fa-solid fa-upload"></i> Export Unknown Boss IDs
                        </button>
                        <p style="font-size:10px; color:#6b7280; margin:8px 0 0 0; font-style:italic;">
                            💡 Copies unknown IDs to clipboard for GitHub issue submission
                        </p>
                    </div>
                    
                    <!-- Default Ranking Setting -->
                    <div style="margin-top:16px; padding:12px; background:rgba(251, 191, 36, 0.1); border-left:3px solid var(--accent-gold); border-radius:4px;">
                        <h4 style="margin:0 0 8px 0; color:#fbbf24; font-size:13px; font-weight:600;">
                            <i class="fa-solid fa-ranking-star"></i> Default Ranking Metric
                        </h4>
                        <p style="font-size:11px; color:#9ca3af; margin:0 0 10px 0;">
                            Choose which metric determines player rankings by default
                        </p>
                        <label style="display:block; margin-bottom:6px;">
                            <select id="setting-default-sort" style="width:100%; padding:6px; background:var(--bg-card); border:1px solid var(--border); color:var(--text-primary); border-radius:4px; font-size:12px;">
                                <option value="totalDmg">Total Damage (Overall Contribution)</option>
                                <option value="avgDps">Average DPS (Sustained Performance)</option>
                                <option value="dps">Current DPS (Real-time Performance)</option>
                                <option value="maxDps">Max DPS (Peak Performance)</option>
                                <option value="hps">HPS (Healing Performance)</option>
                                <option value="dmgTaken">Damage Taken (Tank Metric)</option>
                            </select>
                        </label>
                        <p style="font-size:10px; color:#6b7280; margin:6px 0 0 0; font-style:italic;">
                            💡 You can always click column headers to re-sort temporarily
                        </p>
                    </div>
                </div>

                <!-- Display Tab -->
                <div class="settings-panel" data-panel="display">
                    <h3 style="margin:0 0 8px 0; color:#f3f4f6; font-size:14px;">Column Visibility</h3>
                    <p style="font-size:11px; color:#9ca3af; margin:0 0 16px 0;">
                        Customize which columns appear in each mode independently.
                    </p>
                    
                    <!-- Compact Mode Columns -->
                    <h4 style="margin:0 0 8px 0; color:#fbbf24; font-size:13px; font-weight:600;">
                        <i class="fa-solid fa-compress"></i> Compact Mode (Overlay)
                    </h4>
                    <div class="settings-grid" style="margin-bottom:20px;">
                        <label><input type="checkbox" id="setting-col-compact-dps" checked> Current DPS</label>
                        <label><input type="checkbox" id="setting-col-compact-max-dps" checked> Max DPS</label>
                        <label><input type="checkbox" id="setting-col-compact-avg-dps"> Avg DPS</label>
                        <label><input type="checkbox" id="setting-col-compact-total-dmg" checked> Total DMG</label>
                        <label><input type="checkbox" id="setting-col-compact-hps" checked> HPS / Max</label>
                        <label><input type="checkbox" id="setting-col-compact-dmg-taken"> DMG Taken</label>
                        <label><input type="checkbox" id="setting-col-compact-gs"> Gear Score</label>
                    </div>
                    
                    <!-- Full Mode Columns -->
                    <h4 style="margin:0 0 8px 0; color:#60a5fa; font-size:13px; font-weight:600;">
                        <i class="fa-solid fa-expand"></i> Full Mode (Detailed View)
                    </h4>
                    <div class="settings-grid">
                        <label><input type="checkbox" id="setting-col-full-dps" checked> Current DPS</label>
                        <label><input type="checkbox" id="setting-col-full-max-dps" checked> Max DPS</label>
                        <label><input type="checkbox" id="setting-col-full-avg-dps" checked> Avg DPS</label>
                        <label><input type="checkbox" id="setting-col-full-total-dmg" checked> Total DMG</label>
                        <label><input type="checkbox" id="setting-col-full-hps" checked> HPS / Max</label>
                        <label><input type="checkbox" id="setting-col-full-dmg-taken" checked> DMG Taken</label>
                        <label><input type="checkbox" id="setting-col-full-gs" checked> Gear Score</label>
                    </div>
                    
                    <p style="font-size:10px; color:#6b7280; margin:12px 0 0 0; font-style: italic;">
                        💡 Tip: Use fewer columns in Compact for cleaner overlay, more in Full for detailed analysis
                    </p>
                </div>

                <!-- Overlay Tab -->
                <div class="settings-panel" data-panel="overlay">
                    <h3 style="margin:0 0 15px 0; color:#f3f4f6;">Overlay Settings</h3>
                    <div class="settings-grid">
                        <label><input type="checkbox" id="setting-highlight-local" checked> Highlight My Player</label>
                        <label><input type="checkbox" id="setting-show-gs" checked> Show Gear Score</label>
                    </div>
                    
                    <div style="margin-top:20px;">
                        <h4 style="margin:0 0 10px 0; color:#f3f4f6; font-size:13px;">Overlay Opacity</h4>
                        <div style="display:flex; align-items:center; gap:12px;">
                            <input type="range" id="setting-overlay-opacity" min="0.3" max="1" step="0.05" value="1" style="flex:1;">
                            <span id="opacity-value" style="min-width:45px; color:#9ca3af; font-size:12px;">100%</span>
                        </div>
                    </div>
                </div>

                <!-- About Tab -->
                <div class="settings-panel" data-panel="about">
                    <div style="text-align:center; padding:8px 0;">
                        <h2 style="color:#fbbf24; margin:0 0 2px 0; font-size:15px;">⚔️ Infamous BPSR DPS Meter</h2>
                        <p style="color:#9ca3af; font-size:10px; margin:0;">v3.1.166</p>
                    </div>
                    
                    <div style="padding:8px; background:rgba(251, 191, 36, 0.05); border-radius:4px; border:1px solid rgba(251, 191, 36, 0.2); margin:8px 0;">
                        <p style="color:#d1d5db; font-size:10px; line-height:1.4; margin:0;">
                            Real-time DPS/HPS tracker for Blue Protocol Special Reconstruction
                        </p>
                    </div>
                    
                    <!-- VPN Users Warning -->
                    <div style="padding:8px; background:rgba(251, 191, 36, 0.05); border-radius:4px; border:1px solid rgba(251, 191, 36, 0.3); margin:8px 0;">
                        <h4 style="color:#fbbf24; margin:0 0 6px 0; font-size:11px;">
                            ⚠️ VPN Users
                        </h4>
                        <p style="font-size:9px; color:#d1d5db; margin:0; line-height:1.4;">
                            Packet capture may be delayed up to 2 minutes with VPNs. For best results, disable VPN or view troubleshooting guide.
                        </p>
                    </div>
                    
                    <!-- Data Location -->
                    <div style="padding:8px; background:rgba(59, 130, 246, 0.05); border-radius:4px; border:1px solid rgba(59, 130, 246, 0.2); margin:8px 0;">
                        <h4 style="color:#60a5fa; margin:0 0 6px 0; font-size:11px;">
                            📁 Data Location
                        </h4>
                        <p id="user-data-path" style="font-size:9px; color:#9ca3af; margin:0 0 6px 0; word-break:break-all;">Loading...</p>
                        <button onclick="openDataFolder()" style="width:100%; padding:6px; background:#1e40af; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:9px;">
                            <i class="fa-solid fa-folder-open"></i> Open Data Folder
                        </button>
                        <p style="font-size:8px; color:#6b7280; margin:6px 0 0 0;">Sessions, settings, logs stored here</p>
                    </div>
                    
                    <!-- Credits - Compact -->
                    <div style="padding:8px; background:rgba(59, 130, 246, 0.05); border-radius:4px; border:1px solid rgba(59, 130, 246, 0.2);">
                        <h4 style="color:#60a5fa; margin:0 0 6px 0; font-size:11px;">
                            <i class="fa-solid fa-heart"></i> Credits
                        </h4>
                        <div style="font-size:9px; color:#9ca3af; line-height:1.5;">
                            <p style="margin:0 0 3px 0;">
                                🌟 Original: <a href="https://github.com/dmlgzs/StarResonanceDamageCounter" target="_blank" style="color:#60a5fa">StarResonanceDamageCounter</a> by dmlgzs
                            </p>
                            <p style="margin:0 0 3px 0;">
                                🔱 Forked from: <a href="https://github.com/NeRooNx/BPSR-Meter" target="_blank" style="color:#60a5fa">NeRooNx/BPSR-Meter</a>
                            </p>
                            <p style="margin:0;">
                                📊 BPSR Logs: <a href="https://github.com/winjwinj/bpsr-logs" target="_blank" style="color:#60a5fa">winjwinj/bpsr-logs</a>
                            </p>
                        </div>
                    </div>
                    
                    <!-- Tech Stack -->
                    <div style="padding:8px; background:rgba(59, 130, 246, 0.05); border-radius:4px; border:1px solid rgba(59, 130, 246, 0.2); margin:8px 0;">
                        <h4 style="color:#60a5fa; margin:0 0 6px 0; font-size:11px;">
                            🛠️ Tech Stack
                        </h4>
                        <div style="display:flex; flex-wrap:wrap; gap:4px;">
                            <span style="padding:3px 8px; background:rgba(96, 165, 250, 0.2); border-radius:3px; font-size:8px; color:#93c5fd;">Electron</span>
                            <span style="padding:3px 8px; background:rgba(96, 165, 250, 0.2); border-radius:3px; font-size:8px; color:#93c5fd;">Node.js</span>
                            <span style="padding:3px 8px; background:rgba(96, 165, 250, 0.2); border-radius:3px; font-size:8px; color:#93c5fd;">Express</span>
                            <span style="padding:3px 8px; background:rgba(96, 165, 250, 0.2); border-radius:3px; font-size:8px; color:#93c5fd;">Socket.IO</span>
                            <span style="padding:3px 8px; background:rgba(96, 165, 250, 0.2); border-radius:3px; font-size:8px; color:#93c5fd;">Npcap</span>
                            <span style="padding:3px 8px; background:rgba(96, 165, 250, 0.2); border-radius:3px; font-size:8px; color:#93c5fd;">Protobuf</span>
                        </div>
                    </div>
                    
                    <!-- Check for Updates Button -->
                    <div style="margin-top:10px;">
                        <button onclick="checkForUpdates()" style="width:100%; padding:8px; background:#1e3a8a; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:10px;">
                            <i class="fa-solid fa-sync"></i> Check for Updates
                        </button>
                    </div>
                    
                    <!-- License -->
                    <div style="margin-top:8px; text-align:center;">
                        <p style="font-size:9px; color:#6b7280; margin:0;">
                            AGPL-3.0 License • Open Source
                        </p>
                    </div>
                </div>

                <!-- Save Button -->
                <div style="margin-top:24px; text-align:center;">
                    <button class="btn-primary" id="save-settings">
                        <i class="fa-solid fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/settings-popup.js?v=3.1.166"></script>
</body>
</html>
